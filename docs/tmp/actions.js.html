<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: actions.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: actions.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @module answers/actions
 * @see {@link module:answers/consants|constants}
 */
import {
  ANSWERS_LOADING,
  ANSWERS_LOAD,
  ANSWERS_ERROR_DB,
  ANSWERS_UPDATE,
  ANSWERS_NO_OP,
} from './constants'

/**
 * @constant
 * @type {string}
 * @default
 */
const URL = process.env.REACT_APP_DB_URL || "http://localhost:3001"
const USER_ID = 1

/**
 * @function updateAnswersAC
 * @description Create action meant to override current value of answers to a question in state.
 * @see {@link module:answers/actions~persistAnswersAC|persistAnswersAC} for persistance, like dispatching an API call to the database.
 * @param {integer} question_code - Unique ID corresponding to question these answers relate to
 * @param {Array&lt;string>} answers - One or more strings meant to answer the related question
 * @return {Object}
 * @property {string} type - ANSWERS_UPDATE
 * @property {Object} payload
 * @property {integer} payload.question_code
 * @property {Array&lt;string>} payload.answers
 */
export const updateAnswersAC = (question_code, answers) => {
  return {
    type: ANSWERS_UPDATE,
    payload: { question_code, answers }
  }
}
/**
 * @function loadAllAnswersAC
 * @description Create action meant to fetch user's answers for all questions from API.
 * @async
 * @see {@link module:NavBar|Navbar} componentDidMount for sample implementation
 * @param {integer} userId
 * @return {Object}
 * @property {string} type - ANSWERS_LOAD on success
 * @property {string} type - ANSWERS_ERROR_DB on error
 * @property {Object} payload
 * @property {Array&lt;string>} payload.answers on success
 * @property {Array&lt;string>} payload.error on error
 */
export const loadAllAnswersAC = (userId) => {
  console.log("loadAllAnswersAC()")

  userId = USER_ID

  return dispatch => {
    dispatch({ type: ANSWERS_LOADING })
    return fetch(`${URL}/answers/${userId}`)
      .then(response => response.json())
      .then((answers) => {
        // console.log("answers", answers)
        return dispatch({ type: ANSWERS_LOAD, payload: answers })
      })
      .catch((error) => {
        console.log("FETCH ERROR", error);
        return dispatch({ type: ANSWERS_ERROR_DB, payload: error })
      });
  }
}

/**
 * @function persistAnswersAC
 * @description Create action meant to save user's answers for one question to the API.
 * @async
 * @param {integer} userId
 * @param {integer} question_code - Unique ID corresponding to question these answers relate to
 * @param {Array&lt;string>} answers - One or more strings meant to answer the related question
 * @example
 * &lt;caption>Warning: The following fails because getAnswers is called before the updateAnswersAC operation updates the store.
 * You need to pass "answers" directly to persistQuestionAC.&lt;/caption>
 * this.props.dispatch(updateAnswersAC(question_code, answers))
 // BROKEN: this.props.dispatch(persistAnswersAC(question_code, getAnswers(this.props.answersRD, question_code)))
 */
export const persistAnswersAC = (userId, question_code, answers) => {
  console.log(`persistAnswersAC(${question_code})`)
  console.log("persisting: ", answers);

  userId = USER_ID

  return dispatch => {
    return fetch(`${URL}/answers/${userId}/${question_code}`, {
        method: 'POST',
        body: JSON.stringify({ answers }),
        headers: {
          'Content-Type': 'application/json',
          Accept: 'application/json',
        },
      })
      .then(response => response.json())
      .then((message) => {
        console.log("post response message", message)
        return dispatch( { type: ANSWERS_NO_OP })
      })
      .catch((error) => {
        console.log("POST ERROR", error);
        return dispatch( { type: ANSWERS_ERROR_DB, payload: error } )
      });
  }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-answers_actions.html">answers/actions</a></li><li><a href="module-answers_constants.html">answers/constants</a></li><li><a href="module-answers_reducer.html">answers/reducer</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Mon Jan 21 2019 22:33:24 GMT-0700 (GMT-07:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
